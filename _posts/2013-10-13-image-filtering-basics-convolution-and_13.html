---
layout: post
title: 'Image Filtering Basics: Convolution and Correlation - II'
date: '2013-10-13T12:04:00.001-07:00'
author: Sumit Agrawal
tags: 
modified_time: '2013-10-13T12:04:57.799-07:00'
thumbnail: http://1.bp.blogspot.com/-71zyGjkFxXU/UlrfBU52KtI/AAAAAAAAADQ/MLmhvTi2o7U/s72-c/co.png
blogger_id: tag:blogger.com,1999:blog-680750426739773469.post-6244462927989823663
blogger_orig_url: http://codewithgeeks.blogspot.com/2013/10/image-filtering-basics-convolution-and_13.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">As we discussed in the previous <a href="http://codewithgeeks.blogspot.in/2013/10/image-filtering-basics-convolution-and.html" target="_blank">post</a>&nbsp;opencv allows us to perform convolution and correlations easily.<br />Actually opencv lets you perform correlation only. There is difference in correlation and convolution,<br />for performing convolution we first rotate mask chosen by 180 degree and then apply the procedure discussed in the part I of this post.<br /><br />More formally correlation is defined as<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-71zyGjkFxXU/UlrfBU52KtI/AAAAAAAAADQ/MLmhvTi2o7U/s1600/co.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="55" src="http://1.bp.blogspot.com/-71zyGjkFxXU/UlrfBU52KtI/AAAAAAAAADQ/MLmhvTi2o7U/s320/co.png" width="320" /></a></div>whereas convolution is defined as<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-xCpcyOInVlA/UlrfL7RxV_I/AAAAAAAAADY/1BRr7AZbHJg/s1600/convol.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="50" src="http://2.bp.blogspot.com/-xCpcyOInVlA/UlrfL7RxV_I/AAAAAAAAADY/1BRr7AZbHJg/s320/convol.png" width="320" /></a></div><div class="separator" style="clear: both; text-align: left;">As you can see negative arguments in case of mask F are have negative sign. This corresponds to reflection against x and y axis or in other words rotation by 180 degrees.&nbsp;</div><div class="separator" style="clear: both; text-align: left;">In standard literature mask is also known as kernel, we will follow this convention throughout this blog here onward.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">The <a href="http://docs.opencv.org/modules/imgproc/doc/filtering.html?highlight=filter2d#filter2d" target="_blank">filter2D </a>is a function provided by opencv to perform <b>correlation</b>.&nbsp;</div><div class="separator" style="clear: both; text-align: left;">Signature of filter2D.</div><div class="separator" style="clear: both; text-align: left;"><span class="n" style="color: #333333; line-height: 15px; text-align: justify;"><br /></span></div><div class="separator" style="clear: both; text-align: left;"><span class="n" style="line-height: 15px; text-align: justify;">filter2D</span><span class="p" style="line-height: 15px; text-align: justify;">(</span><span class="n" style="line-height: 15px; text-align: justify;">src</span><span class="p" style="line-height: 15px; text-align: justify;">,&nbsp;</span><span class="n" style="line-height: 15px; text-align: justify;">dst</span><span class="p" style="line-height: 15px; text-align: justify;">,&nbsp;</span><span class="n" style="line-height: 15px; text-align: justify;">ddepth</span><span class="p" style="line-height: 15px; text-align: justify;">,&nbsp;</span><span class="n" style="line-height: 15px; text-align: justify;">kernel</span><span class="p" style="line-height: 15px; text-align: justify;">,&nbsp;</span><span class="n" style="line-height: 15px; text-align: justify;">anchor</span><span class="p" style="line-height: 15px; text-align: justify;">,&nbsp;</span><span class="n" style="line-height: 15px; text-align: justify;">delta</span><span class="p" style="line-height: 15px; text-align: justify;">,Border_Type</span><span class="p" style="line-height: 15px; text-align: justify;">);</span>&nbsp; &nbsp;&nbsp;</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Mat src : source image.</div><div class="separator" style="clear: both; text-align: left;">Mat dst : destination image.</div><div class="separator" style="clear: both; text-align: left;">ddepth : image depth of the destination.</div><div class="separator" style="clear: both; text-align: left;">kernel : Mask function.</div><div class="separator" style="clear: both; text-align: left;">Anchor : represents location of anchor/ origo w.r.t the kernel.</div><div class="separator" style="clear: both; text-align: justify;">delta : a value to be added to each pixel during convolution.</div><div class="separator" style="clear: both; text-align: justify;">Border_Type : Way to pad image.</div><div class="separator" style="clear: both; text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: justify;"><script type="syntaxhighlighter" class="brush : cpp"><![CDATA[ // Scan Images and Modify. #include<iostream>#include "cv.h" #include "highgui.h" #include <cstring>using namespace cv; using namespace std;  // Function getSum returns total sum of all the elements of given matrix. // This function makes use of iterator classes to access elements of given matrix. // To learn more about iterator classes, please read my posts // Image Processing Basics: Part I and Part II float getSum(Mat kernel) {  float sum = 0;  for(typeof(kernel.begin<float>()) it = kernel.begin<float>(); it!= kernel.end<float>() ; it++)  {   sum+=*it;  }  return sum; }  int main() {  string path = "res/download.jpg";  Mat src = imread(path,CV_LOAD_IMAGE_ANYCOLOR);  if(!src.data)  {   cout<<"fail\n";   return -1;  }  Mat dest;   // default point, represents center of the kernel.  Point anchor = Point(-1,-1);   double delta = 0;   // negative values of ddepth indicate that depth of source and destination Mat is same.  int ddepth = -1;   // Mask.  // Change kernel here to achieve different effects.  Mat kernel = Mat::ones(5,5,CV_32F);   // Normalize the mask.  kernel = kernel / (float) getSum(kernel) ;   // Calling filter2D  filter2D(src,dest,ddepth,kernel,anchor,delta,BORDER_DEFAULT);   namedWindow("original",CV_WINDOW_AUTOSIZE);  namedWindow("out",CV_WINDOW_AUTOSIZE);   imshow("out",src);  imshow("original",dest);   waitKey(0);   // write output to disk.  imwrite("res/original.png",src);  imwrite("res/out.png",dest);  return 0; } ]]></script></div><div class="separator" style="clear: both; text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: justify;">Results:</div><div class="separator" style="clear: both; text-align: justify;">Original Image</div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-oxi21mS_ulQ/UlrtRZNUNlI/AAAAAAAAADo/qTyQiWcJnWw/s1600/original.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-oxi21mS_ulQ/UlrtRZNUNlI/AAAAAAAAADo/qTyQiWcJnWw/s1600/original.png" /></a></div><div class="separator" style="clear: both; text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: justify;">With blur operator of size 5x5</div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-Owil8mDs2cI/UlrtlQksVLI/AAAAAAAAADw/3JFtLmm3Lko/s1600/out.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-Owil8mDs2cI/UlrtlQksVLI/AAAAAAAAADw/3JFtLmm3Lko/s1600/out.png" /></a></div><div class="separator" style="clear: both; text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: justify;"><br /></div></div>